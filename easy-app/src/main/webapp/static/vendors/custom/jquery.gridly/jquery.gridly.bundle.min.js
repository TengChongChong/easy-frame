(function(){"use strict";var t,i,e,n=function(t,i){return function(){return t.apply(i,arguments)}},s=[].slice;t=jQuery,function(){function t(){}t.transitions={webkitTransition:"webkitTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd",transition:"transitionend"},t.transition=function(t){var i,e,n,s;for(s in i=t[0],e=this.transitions)if(n=e[s],null!=i.style[s])return n},t.execute=function(t,i){var e;return null!=(e=this.transition(t))?t.one(e,i):i()}}(),i=function(){function i(t,i,e){this.touchend=n(this.touchend,this),this.click=n(this.click,this),this.moved=n(this.moved,this),this.ended=n(this.ended,this),this.began=n(this.began,this),this.coordinate=n(this.coordinate,this),this.off=n(this.off,this),this.on=n(this.on,this),this.toggle=n(this.toggle,this),this.bind=n(this.bind,this),this.$container=t,this.selector=i,this.callbacks=e,this.toggle()}return i.prototype.bind=function(i){return null==i&&(i="on"),t(document)[i]("mousemove touchmove",this.moved),t(document)[i]("mouseup touchcancel",this.ended)},i.prototype.toggle=function(t){return null==t&&(t="on"),this.$container[t]("mousedown touchstart",this.selector,this.began),this.$container[t]("touchend",this.selector,this.touchend),this.$container[t]("click",this.selector,this.click)},i.prototype.on=function(){return this.toggle("on")},i.prototype.off=function(){return this.toggle("off")},i.prototype.coordinate=function(t){switch(t.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return t.originalEvent.touches[0];default:return t}},i.prototype.began=function(i){var e;if(!this.$target)return i.preventDefault(),i.stopPropagation(),this.bind("on"),this.$target=t(i.target).closest(this.$container.find(this.selector)),this.$target.addClass("dragging"),this.origin={x:this.coordinate(i).pageX-this.$target.position().left,y:this.coordinate(i).pageY-this.$target.position().top},null!=(e=this.callbacks)&&"function"==typeof e.began?e.began(i):void 0},i.prototype.ended=function(t){var i;if(null!=this.$target)return"touchend"!==t.type&&(t.preventDefault(),t.stopPropagation()),this.bind("off"),this.$target.removeClass("dragging"),delete this.$target,delete this.origin,null!=(i=this.callbacks)&&"function"==typeof i.ended?i.ended(t):void 0},i.prototype.moved=function(t){var i;if(null!=this.$target)return t.preventDefault(),t.stopPropagation(),this.$target.css({left:this.coordinate(t).pageX-this.origin.x,top:this.coordinate(t).pageY-this.origin.y}),this.dragged=this.$target,null!=(i=this.callbacks)&&"function"==typeof i.moved?i.moved(t):void 0},i.prototype.click=function(t){if(this.dragged)return t.preventDefault(),t.stopPropagation(),delete this.dragged},i.prototype.touchend=function(t){return this.ended(t),this.click(t)},i}(),e=function(){function e(i,s){return null==s&&(s={}),this.optimize=n(this.optimize,this),this.layout=n(this.layout,this),this.structure=n(this.structure,this),this.position=n(this.position,this),this.size=n(this.size,this),this.draggingMoved=n(this.draggingMoved,this),this.draggingEnded=n(this.draggingEnded,this),this.draggingBegan=n(this.draggingBegan,this),this.$sorted=n(this.$sorted,this),this.draggable=n(this.draggable,this),this.compare=n(this.compare,this),this.$=n(this.$,this),this.reordinalize=n(this.reordinalize,this),this.ordinalize=n(this.ordinalize,this),this.$el=i,this.settings=t.extend({},e.settings,s),this.ordinalize(this.$("> *")),!1!==this.settings.draggable&&this.draggable(),this}return e.settings={base:60,gutter:20,columns:12,draggable:{zIndex:800,selector:"> *"}},e.gridly=function(i,n){var s;return null==n&&(n={}),(s=i.data("_gridly"))?t.extend(s.settings,n):(s=new e(i,n),i.data("_gridly",s)),s},e.prototype.ordinalize=function(i){var e,n,s,o,r;for(r=[],n=s=0,o=i.length;0<=o?s<=o:s>=o;n=0<=o?++s:--s)e=t(i[n]),r.push(e.data("position",n));return r},e.prototype.reordinalize=function(t,i){return t.data("position",i)},e.prototype.$=function(t){return this.$el.find(t)},e.prototype.compare=function(t,i){return t.y>i.y+i.h?1:i.y>t.y+t.h?-1:t.x+t.w/2>i.x+i.w/2?1:i.x+i.w/2>t.x+t.w/2?-1:0},e.prototype.draggable=function(t){if(null==this._draggable&&(this._draggable=new i(this.$el,this.settings.draggable.selector,{began:this.draggingBegan,ended:this.draggingEnded,moved:this.draggingMoved})),null!=t)return this._draggable[t]()},e.prototype.$sorted=function(i){return(i||this.$("> *")).sort(function(i,e){var n,s,o,r,h,a;return n=t(i),s=t(e),o=n.data("position"),h=s.data("position"),r=parseInt(o),a=parseInt(h),null!=o&&null==h?-1:null!=h&&null==o?1:!o&&!h&&n.index()<s.index()?-1:!h&&!o&&s.index()<n.index()?1:r<a?-1:a<r?1:0})},e.prototype.draggingBegan=function(t){var i,e,n;return i=this.$sorted(),this.ordinalize(i),setTimeout(this.layout,0),null!=(e=this.settings)&&null!=(n=e.callbacks)&&"function"==typeof n.reordering?n.reordering(i):void 0},e.prototype.draggingEnded=function(t){var i,e,n;return i=this.$sorted(),this.ordinalize(i),setTimeout(this.layout,0),null!=(e=this.settings)&&null!=(n=e.callbacks)&&"function"==typeof n.reordered?n.reordered(i,this._draggable.dragged):void 0},e.prototype.draggingMoved=function(i){var e,n,s,o,r,h,a,g,l,u,d;for(e=t(i.target).closest(this.$(this.settings.draggable.selector)),n=this.$sorted(this.$(this.settings.draggable.selector)),g=this.structure(n).positions,e.data("position"),r=0,a=(l=g.filter(function(t){return t.$element.is(e)})).length;r<a;r++)(s=l[r]).x=e.position().left,s.y=e.position().top,s.w=e.data("width")||e.outerWidth(),s.h=e.data("height")||e.outerHeight();for(g.sort(this.compare),n=g.map(function(t){return t.$element}),o=h=0,d=(n=((null!=(u=this.settings.callbacks)?u.optimize:void 0)||this.optimize)(n)).length;0<=d?h<d:h>d;o=0<=d?++h:--h)this.reordinalize(t(n[o]),o);return this.layout()},e.prototype.size=function(t){return((t.data("width")||t.outerWidth())+this.settings.gutter)/(this.settings.base+this.settings.gutter)},e.prototype.position=function(t,i){var e,n,s,o,r,h,a,g,l,u;for(u=this.size(t),n=1/0,e=0,s=o=0,a=i.length-u;0<=a?o<a:o>a;s=0<=a?++o:--o)(h=Math.max.apply(Math,i.slice(s,s+u)))<n&&(n=h,e=s);for(s=r=g=e,l=e+u;g<=l?r<l:r>l;s=g<=l?++r:--r)i[s]=n+(t.data("height")||t.outerHeight())+this.settings.gutter;return{x:e*(this.settings.base+this.settings.gutter),y:n}},e.prototype.structure=function(i){var e,n,s,o,r,h,a;for(null==i&&(i=this.$sorted()),h=[],n=function(){var t,i,e;for(e=[],t=0,i=this.settings.columns;0<=i?t<=i:t>=i;0<=i?++t:--t)e.push(0);return e}.call(this),s=o=0,a=i.length;0<=a?o<a:o>a;s=0<=a?++o:--o)e=t(i[s]),r=this.position(e,n),h.push({x:r.x,y:r.y,w:e.data("width")||e.outerWidth(),h:e.data("height")||e.outerHeight(),$element:e});return{height:Math.max.apply(Math,n),positions:h}},e.prototype.layout=function(){var i,e,n,s,o,r,h,a;for(e=((null!=(r=this.settings.callbacks)?r.optimize:void 0)||this.optimize)(this.$sorted()),a=this.structure(e),n=s=0,h=e.length;0<=h?s<h:s>h;n=0<=h?++s:--s)i=t(e[n]),o=a.positions[n],i.is(".dragging")||i.css({position:"absolute",left:o.x,top:o.y});return this.$el.css({height:a.height})},e.prototype.optimize=function(i){var e,n,s,o,r;for(r=[],e=0;i.length>0;){for(e===this.settings.columns&&(e=0),n=0,n=s=0,o=i.length;(0<=o?s<o:s>o)&&e+this.size(t(i[n]))>this.settings.columns;n=0<=o?++s:--s);n===i.length&&(n=0,e=0),e+=this.size(t(i[n])),r.push(i.splice(n,1)[0])}return r},e}(),t.fn.extend({gridly:function(){var i,n;return i=arguments[0],n=2<=arguments.length?s.call(arguments,1):[],null==i&&(i={}),this.each(function(){var s,o,r;return s=t(this),r=t.extend({},t.fn.gridly.defaults,"object"==typeof i&&i),null==(o="string"==typeof i?i:i.action)&&(o="layout"),e.gridly(s,r)[o](n)})}})}).call(this);